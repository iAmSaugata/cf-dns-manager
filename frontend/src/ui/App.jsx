
import React, { useEffect, useMemo, useState } from 'react'
const api = async (p,o={})=>{const pw=localStorage.getItem('app_password')||'';const r=await fetch(`/api${p}`,{...o,headers:{'x-app-password':pw,'Content-Type':'application/json',...(o.headers||{})},credentials:'same-origin',cache:'no-store'});let d={};try{d=await r.json()}catch{}if(!r.ok||d.success===false){const e=new Error(d?.error||`Request failed (${r.status})`);e.status=r.status;e.payload=d;throw e}return d}
const Logout=()=> <button className="btn secondary" onClick={()=>{document.cookie='app_password=; Max-Age=0; Path=/';localStorage.removeItem('app_password');location.reload()}}>Sign out</button>
function Login({onDone}){const [p,setP]=useState(''),[busy,setBusy]=useState(false),[err,setErr]=useState('');const go=async()=>{setBusy(true);setErr('');try{localStorage.setItem('app_password',p);document.cookie=`app_password=${encodeURIComponent(p)}; Path=/; SameSite=Lax`;const r=await fetch('/api/health',{headers:{'x-app-password':p},credentials:'same-origin'});if(!r.ok)throw new Error('Invalid password');onDone()}catch(e){setErr(e.message)}finally{setBusy(false)}};return <div className='center'><div className='card' style={{width:'100%',maxWidth:520,padding:'22px'}}><div className='title' style={{marginBottom:8}}>Login</div><p className='muted'>Enter the password you configured in <b>APP_PASSWORD</b>.</p><input type='password' placeholder='Password' value={p} onChange={e=>setP(e.target.value)} /><div style={{marginTop:12,display:'flex',gap:10,justifyContent:'space-between'}}><button className='btn' disabled={busy||!p} onClick={go}>{busy?'Checking…':'Login'}</button><button className='btn secondary' onClick={()=>{setP('');}}>Clear</button></div>{err&&<p className='muted'>Error: {err}</p>}<div className='footer'>Powered by Cloudflare DNS API • © iAmSaugata</div></div></div>}
function App(){const [logged,setLogged]=useState(!!localStorage.getItem('app_password'));return logged?<div className='wrap'><div className='header'><div className='title'>App shell (v6) compiled</div><Logout/></div><div className='card'><p className='muted'>Build includes modal, toolbar add button, etc. (UI trimmed in this minimal demo)</p></div></div>:<Login onDone={()=>setLogged(true)}/>}
export default App
